Status: Canonical (LOCKED FOR BUILD)
System of Record: Railway Postgres — GrantPilot DB
Applies to:

funding_opportunities table

CSV imports

Admin/manual entry

Proposal generation inputs

Enum Authority:
All enum values referenced in this document are defined in ENUM_REGISTRY.md.
If a conflict exists, ENUM_REGISTRY.md is the source of truth.

Field Renaming (authoritative):
structured_requirements → requirements_json

1. Canonical Table: funding_opportunities
1.1 Identity & System-Managed Fields

“These fields are intended to be system-managed. They are NOT required in CSV imports only after DB defaults are in place (CSV Mode B). Until then, follow CSV Mode A.”

id (UUID, PRIMARY KEY, NOT NULL)

Generated by the system.

created_at (timestamp, NOT NULL)

Default: now()

Set by the database on insert.

updated_at (timestamp, NOT NULL)

Default: now() on insert.

Updated by application logic on mutation.

1.2 Provenance & URLs (Required)

source_url (text, NOT NULL)
Canonical source page describing the opportunity.

application_url (text, NOT NULL)
Canonical destination for application submission.
May be equal to source_url.

1.3 Opportunity Snapshot (Search, List, Filters)

These fields support discovery, filtering, and UX display.

title (text, NOT NULL)

donor_organization (text, NOT NULL)

funding_type (text, NOT NULL)

applicant_type (applicant_type ENUM, NOT NULL)
See ENUM_REGISTRY.md.

location_text (text, NOT NULL)
Human-readable primary geography.

focus_areas (text, NOT NULL)
Comma-separated list (MVP).
Future: structured array.

deadline_type (deadline_type ENUM, NOT NULL)
See ENUM_REGISTRY.md.

application_deadline (date, NULLABLE)
Constraint:

MUST be NOT NULL when deadline_type = FIXED

MAY be NULL when deadline_type = ROLLING or VARIES

Conditional requirement: when deadline_type = FIXED, application_deadline MUST be provided.

1.4 Funding Amounts (Nullable)

Unknown values are valid.

currency (text, nullable; ISO recommended)

amount_min (numeric, nullable)

amount_max (numeric, nullable)

total_funding_available (numeric, nullable)

1.5 Publisher / UX Text

short_summary (text, NOT NULL)
1–2 lines for listings.

overview_text (text, nullable)
Longer narrative description.

1.6 Eligibility & Process (Human-Readable)

These fields exist for UX and curator clarity.
They do not drive proposal generation directly.

eligibility_criteria (text, nullable)

application_process (text, nullable)

1.7 Status & Lifecycle (Required)

status (opportunity_status ENUM, NOT NULL)
See ENUM_REGISTRY.md.

is_active (boolean, NOT NULL, default true)

is_archived (boolean, NOT NULL, default false)

last_verified (date, nullable)

1.8 Authoritative Requirements Contract

requirements_json (JSONB, NOT NULL)

This field is mandatory and is the single source of truth for proposal generation.

1.9 Optional / Operational Fields

organization_types (text, nullable)

geographic_focus (text, nullable)

contact_information (text, nullable)

processing_status (text, nullable)

parsing_confidence (numeric, nullable)

internal_notes (text, nullable)

2. Authoritative JSON Contract: requirements_json
2.1 Contract Intent

requirements_json is the authoritative representation of:

Application variants / tracks

Required submission items

Required documents / attachments

Detailed process and eligibility notes

Proposal generation MUST be driven by:
requirements_json.variants[*].submission_items

Flat table fields MUST NOT be used to infer proposal sections.

2.2 Required Top-Level Schema
{
  "version": "1.0",
  "opportunity_mode": "SINGLE | VARIANTS",
  "variants": [],
  "global_notes": {
    "review_criteria": [],
    "red_flags": [],
    "internal_curator_notes": ""
  }
}


Rules

version MUST be "1.0" for MVP.

variants MUST contain:

exactly 1 variant when opportunity_mode = "SINGLE"

1 or more variants when opportunity_mode = "VARIANTS"

2.3 Variant Schema (Required)

Each element of variants[] MUST conform to:

{
  "variant_id": "string",
  "variant_name": "string",
  "deadline_type": "FIXED | ROLLING | VARIES",
  "application_deadline": "YYYY-MM-DD or null",
  "eligibility_rules": {
    "applicant_type": "NGO | INDIVIDUAL | ACADEMIC_INSTITUTION | CONSORTIUM | MIXED",
    "geographies": ["string"],
    "org_types_allowed": ["string"],
    "org_types_excluded": ["string"],
    "themes_required": ["string"],
    "themes_excluded": ["string"],
    "notes": "string"
  },
  "submission_items": [],
  "required_documents": [],
  "process_notes": {
    "how_to_apply": "string",
    "portal_steps": ["string"],
    "special_conditions": ["string"]
  }
}


Rules

If deadline_type = FIXED, application_deadline MUST be non-null.

eligibility_rules.applicant_type MUST align with table-level applicant_type:

If table-level is broader (e.g. MIXED), variants may narrow.

Any mismatch MUST be explained in eligibility_rules.notes.

2.4 Submission Item Schema (Required)

Each element of submission_items[] MUST conform to:

{
  "item_id": "string",
  "label": "string",
  "type": "NARRATIVE | TABLE | UPLOAD | DECLARATION | PORTAL_FIELD | OTHER",
  "prompt_text": "string",
  "mandatory": true,
  "format_constraints": {
    "word_limit": 0,
    "page_limit": 0,
    "file_types": ["PDF", "DOCX", "XLSX"],
    "template_url": "string or null",
    "notes": "string"
  },
  "evaluation_hint": "string or null",
  "inputs_required": ["ngo_profile.<field_name>"],
  "generation_allowed": true
}


Rules

prompt_text MUST be either:

the funder’s exact wording, OR

a faithful curator-authored restatement (no speculation).

If generation_allowed = false, the system MUST NOT fabricate content and MUST recommend upload/manual completion.

submission_items MUST be non-empty when status = READY or PUBLISHED.

2.5 Required Document Schema
{
  "doc_id": "string",
  "name": "string",
  "mandatory": true,
  "type": "UPLOAD | TEMPLATE | EVIDENCE",
  "format": "PDF | DOCX | XLSX | OTHER",
  "notes": "string",
  "generation_allowed": false
}

3. Table vs Variant Precedence Rules

Table-level fields exist for:

search, filtering, and UX display

high-level summarisation of the opportunity

Variant-level fields are authoritative for proposal generation

Precedence Rules

SINGLE mode

Table-level deadline_type, application_deadline, applicant_type MUST match the single variant.

VARIANTS mode

Table-level fields act as an umbrella:

deadline_type = VARIES if variants differ

application_deadline = NULL if multiple deadlines exist

applicant_type = MIXED if variants differ

Variant-level values always override table-level values for generation logic.

4. CSV Import Contract (MVP)
4.1 CSV Import Responsibilities

CSV imports MUST populate:

All required flat fields

requirements_json as valid JSON conforming to Section 2

Important: Timestamp/ID requirements depend on whether DB defaults exist. This document supports two modes.

4.2 CSV Mode A — Current DB (if id/created_at/updated_at have no defaults)

Required CSV columns (Mode A):

System fields:

id

created_at

updated_at

Required business fields:

source_url

application_url

title

donor_organization

funding_type

applicant_type

location_text

focus_areas

deadline_type

short_summary

status

is_active

is_archived

requirements_json

Other fields (nullable; include if available):

application_deadline

currency

amount_min

amount_max

total_funding_available

overview_text

eligibility_criteria

application_process

last_verified

organization_types

geographic_focus

contact_information

processing_status

parsing_confidence

internal_notes

4.3 CSV Mode B — Target DB (recommended after adding DB defaults)

Required CSV columns (Mode B):

Business fields:

source_url

application_url

title

donor_organization

funding_type

applicant_type

location_text

focus_areas

deadline_type

short_summary

status

is_active

is_archived

requirements_json

Other fields (nullable; include if available):

application_deadline

currency

amount_min

amount_max

total_funding_available

overview_text

eligibility_criteria

application_process

last_verified

organization_types

geographic_focus

contact_information

processing_status

parsing_confidence

internal_notes

System-managed (not required in CSV in Mode B):

id

created_at

updated_at

5. Validation & Degradation Rules
5.1 DB Integrity (Must Enforce)

Required flat fields MUST exist.

When deadline_type = FIXED, application_deadline MUST exist.

When status = READY or PUBLISHED, submission_items MUST be non-empty.

5.2 Proposal Engine Behaviour

If:

requirements_json is missing or invalid, OR

submission_items is empty for READY/PUBLISHED,

Then:

Do NOT infer proposal sections.

Return a degraded response indicating missing requirements and required curator actions.